<!DOCTYPE html>
<html>
  <head>
    <title>Source for index</title>
    <!-- W3.css -->
        <script src="https://www.w3schools.com/lib/w3codecolor.js"></script>
  </head>
  <div class="w3-code htmlHigh">

<!DOCTYPE html>
<html>
    <head>
        <title>WebCommentSystem</title>
        <script src = "/cookielib"></script>
        <script src = "/linklib"></script>
        <!-- JQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <!-- W3.css -->
        <script src="https://www.w3schools.com/lib/w3codecolor.js"></script>
        <!-- Latest compiled and minified CSS for bootstrap 5 -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <!-- Latest compiled JavaScript for bootstrap 5 -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    </head>
    <body>
        <div class="container p-2 my-1">
            <h2>WebCommentSystem</h2>
        </div>
        <div class="container mt-3">
            <table id="table" class="table">
                <thread><tr><th>Name</th><th>Message</th></tr></thread>
            </table>
        </div>
        <div class="container mt-2 gap-1">
            <form action="/submit" method="post" id = "form">
                <div class="mb-0 mt-0">
                    <label for="username" class="form-label">Name:</label>
                    <input type="text" id="username" class="form-control" placeholder="Enter Name" name="username" required><br><br>
                </div>
                <div class="mb-0">
                    <label for="email" class="form-label">Email:</label>
                    <input type="email" id="email" class="form-control" placeholder="Enter Email" name="email" required><br><br>
                </div>
                <div class="mb-0">
                    <label for="message" class="form-label">Message:</label>
                    <input type="text" id="message" class="form-control" placeholder="Enter Message" name="message" required><br><br>
                </div>
                <input type="submit" value="Submit" class="btn btn-primary">
            </form>
        </div>
        <script>
            //connor_33341, https://connor33341.guthub.io/examples/webcomment/source.html
            //Please Give Credit, I spent an hour out of my day writing this
            //Made the mistake of writing this without using jquery
            const table = document.getElementById("table")
            const form = document.getElementById("form")
            const tableDefault = table.innerHTML
            function run(){
                console.log("Updated")
                var xhr = new XMLHttpRequest()
                xhr.onreadystatechange = function(){
                    if (xhr.readyState === 4 && xhr.status === 200){
                        table.innerHTML = tableDefault
                        var response = xhr.responseText
                        var parsedData = JSON.parse(response)
                        var data = Object.entries(parsedData)
                        for (let index in data){
                            var object = data[index]
                            var objectData = object[1]
                            var name = objectData[0]
                            var message = objectData[1]
                            table.innerHTML = table.innerHTML + "<tr><td>"+name+"</td><td>"+message+"</td></tr>"
                        }
                        console.log(response)
                    }
                }
                xhr.open("GET","/load")
                xhr.send()
                var cookie = getCookieValue("valid")
                if (cookie == "False"){
                    //form.hidden = true
                    $(form).hide()
                    form.innerHTML = ""
                    var Link = NewLink("/form")
                    Link.click()
                }
            }
            $(document).ready(function(){
                run()
            })
            setInterval(run, 10000)
        </script>
    </body>
</html>

  </div>
</html>
